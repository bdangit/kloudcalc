$(function(){var d=Backbone.Model.extend({defaults:function(){return{qty:0,name:"Server",instanceSize:AWS.COMPUTE.EC2.T1_MICRO,os:OS.LINUX,region:AWS.REGIONS.US_EAST_1,hoursPerMonth:730,cost:"0.00"}},initialize:function(){this.bind("change:qty",function(){this.calc()});this.bind("change:hoursPerMonth",function(){this.calc()});this.bind("change:instanceSize",function(){this.calc()});this.bind("change:os",function(){this.calc()});this.bind("change:region",function(){this.calc()})},calc:function(){var a=
0;if(this.get("os")==OS.LINUX){var b=this.get("instanceSize").LINUX,c;for(c in b)if(this.get("region").index==b[c].index){a=b[c].price;break}}else if(this.get("os")==OS.WIN)for(c in b=this.get("instanceSize").WIN,b){if(this.get("region").index==b[c].index){a=b[c].price;break}}else console.log("can't find OS");this.set({cost:(this.get("qty")*this.get("hoursPerMonth")*a).toFixed(2)})},clear:function(){this.destroy()}});Backbone.Model.extend({defaults:function(){return{qty:0,name:"Data Volume",size:1,
vendor:VENDORS.AWS,region:AWS.REGIONS.US_EAST_1,cost:"0.00"}}}).extend({defaults:function(){return{ioRequests:10}}});var e=Backbone.View.extend({model:d,tagName:"div",className:"row-fluid",attributes:{style:"margin-bottom: 20px"},template:_.template($("#compute-block-template").html()),events:{"click button.destroy":"clear","keyup #qty":"setQty","keyup #name":"setName","change #os":"setOS","keyup #os":"setOS","change #instance-size":"setInstanceSize","keyup #instance-size":"setInstanceSize","change #region":"setRegion",
"keyup #region":"setRegion","keyup #hours-per-month":"setHoursPerMonth"},defaults:function(){return{blockId:0}},initialize:function(){this.model.bind("destroy",this.remove,this)},render:function(){this.$el.html(this.template(this.model.toJSON()));return this},setQty:function(){var a=this.$("#qty").val();this.model.set({qty:parseInt(a,10)});this.updateCost()},setName:function(){this.model.set({name:this.$("#name").val()})},setOS:function(){var a=this.$("#os").val();"Linux"==a?this.model.set({os:OS.LINUX}):
"Windows"==a?this.model.set({os:OS.WIN}):console.log("can't find OS");this.updateCost()},setInstanceSize:function(){var a=this.$("#instance-size").val();for(sz in AWS.COMPUTE.EC2)if(a==AWS.COMPUTE.EC2[sz].name){this.model.set({instanceSize:AWS.COMPUTE.EC2[sz]});break}this.updateCost()},setRegion:function(){var a=this.$("#region").val();for(region in AWS.REGIONS)if(a==AWS.REGIONS[region].name){this.model.set({region:AWS.REGIONS[region]});break}this.updateCost()},setHoursPerMonth:function(){var a=this.$("#hours-per-month").val();
this.model.set({hoursPerMonth:parseInt(a,10)});this.updateCost()},updateCost:function(){var a=this.$("#cost"),b=this.model.get("cost");"NaN"==b&&(b="0.00");a.text("$"+b)},clear:function(){console.log("["+this.options.blockId+"] Goodbye "+this.model.get("name")+"!");this.model.clear()}});new (Backbone.View.extend({el:$("#kloudcalc-app"),events:{"click #add-compute-block":"addComputeBlock","keyup '#block-list,#cost'":"updateTotalCost","click '#block-list,#cost'":"updateTotalCost","change '#block-list,#cost'":"updateTotalCost",
"click '#block-list,button.destroy'":"updateTotalCost"},defaults:function(){return{numBlocks:1}},initialize:function(){this.header=this.$("#header");this.totalCostField=this.$("#total-cost");this.blockList=this.$("#block-list");this.main=this.$("#main");this.footer=this.$("#footer")},addComputeBlock:function(){var a=new e({model:new d,id:"compute-block-"+this.numBlocks,blockId:this.numBlocks});this.numBlocks+=1;this.blockList.append(a.render().el)},updateTotalCost:function(){var a=0;this.$("#cost").each(function(){a+=
parseFloat($(this).text().split("$")[1])});this.totalCostField.text("$"+a.toFixed(2))}}))});
